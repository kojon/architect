# 项目入门

### 简介

​	微服务网关 Zuul：网关是系统唯一对外的入口，介于客户端与服务器端之间，用于对请求进行鉴权、限流、 路由、监控等功能。

​	ZUUL 是从设备和 web 站点到 Netflix 流应用后端的所有请求的前门。作为边界服务 应用，ZUUL 是为了实现动态路由、监视、弹性和安全性而构建的。它还具有根据情况将请 求路由到多个 Amazon Auto Scaling Groups(亚马逊自动缩放组，亚马逊的一种云计算方式) 的能力。

### 操作手册

github https://github.com/Netflix/zuul/wiki

spring https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.1.2.RELEASE/single/spring-cloud-netflix.html#_router_and_filter_zuul

### 功能说明

​	将 Zuul 放到整个系统架构中，其作用是这样的:服务提供者是消费者通过 EurekaServer 进行访问的，即相当于 EurekaServer 是服务提供者的统一入口。那么服务消费者很多，用户 怎样访问这些消费者工程呢?当然可以像之前那样直接访问这些工程。但这种方式没有统一 的消费者工程调用入口，不便于访问与管理，而 Zuul 就是这样的一个对于消费者的统一入 口。

Zuul 主要提供了对请求的路由与过滤功能。

- 路由:将外部请求转发到具体的微服务主机，是外部访问微服务系统的统一入口  

- 过滤:对外部请求进行干预等

![](https://hlvan-st.oss-cn-beijing.aliyuncs.com/property/upload/20190705182237.png)

![](https://hlvan-st.oss-cn-beijing.aliyuncs.com/property/upload/20190705182337.png)

### 路由策略配置

​	自定义路径来替代微服务名称，即自定义路由策略。

### 路由前辍

### 服务名屏蔽

### 路径屏蔽

#### 敏感请求头屏蔽

​	默认情况下，像 Cookie、Set-Cookie 等敏感请求头信息会被 zuul 屏蔽掉。我们可以将这些默认屏蔽去掉，当然，也可以添加要屏蔽的请求头。

### 负载均衡

​	用户提交的请求被路由到一个指定的微服务中，若该微服务名称的主机有多个，则默认采用负载均衡策略是轮询。

### 服务降级

​	当消费者调用提供者时由于各种原因出现无法调用的情况时，消费者可以进行服务降级。 那么，若客户端通过网关调用消费者无法调用时，是否可以进行服务降级呢?当然可以，zuul 具有服务降级功能。

### 路由过滤

​	在服务路由之前、中、后，可以对请求进行过滤，使其只能访问它应该访问到的资源，增强安全性。此时需要通过 ZuulFilter 过滤器来实现对外服务的安全控制。

### 令牌桶限流

​	通过对请求限流的方式避免系统遭受“雪崩之灾”。我们下面的代码使用 Guava(Google 的一种基于 Java 的开源库)的 RateLimit 完成限流 的，而其底层使用的是令牌桶算法实现的限流，所以我们先来学习一下令牌桶限流算法。

![](https://hlvan-st.oss-cn-beijing.aliyuncs.com/property/upload/20190705183330.png)

### 多维请求限流

​	使用 Guava 的 RateLimit 令牌桶算法可以实现对请求的限流，但其限流粒度有些大。有 个老外使用路由过滤，针对 Zuul 编写了一个限流库(spring-cloud-zuul-ratelimit)，提供多种细 粒度限流策略，在导入该依赖后我们就可以直接使用了。
其限流策略，即限流查验的对象类型有:
-  user:针对用户的限流，即对单位时间窗内经过该网关的用户数量的限制
- origin:针对客户端IP的限流，即对单位时间窗内经过该网关的IP数量的限制
- url:针对请求URL的限流，即对单位时间窗内经过该网关进行请求的URL数量的限制

### 灰度发布

​	灰度发布，又名金丝雀发布(当然，也存在这是两种不同发布方式的说法)，是系统迭 代更新、平滑过渡的一种上线发布方式。

​	生产环境中，可以实现灰度发布的技术很多，我们这里要讲的是 zuul 对于灰度发布的 实现。而其实现是基于 Eureka 元数据的。

Eureka 元数据是指，Eureka 客户端向 Eureka Server 中注册时的描述信息。有两种类型 的元数据:

- 标准元数据 
- 自定义元数据

### Zuul 的高可用

​	Zuul 的高可用非常关键，因为外部请求到后端微服务的流量都会经过 Zuul。故而在生产 环境中，我们一般都需要部署高可用的 Zuul 以避免单点故障。
作为整个系统入口路由的高可用，需要借助额外的负载均衡器来实现，例如 Nginx、 HAProxy、F5 等。在 Zuul 集群的前端部分部署负载均衡服务器。Zuul 客户端将请求发送到负 载均衡器，负载均衡器将请求转发到其代理的其中一个 Zuul 节点。这样，就可以实现 Zuul 的高可用。